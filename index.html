<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Practice IT Self-Assessment</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Prop-Types (Required for Recharts UMD) -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Recharts (Pinned Version for Stability) -->
    <script src="https://unpkg.com/recharts@2.12.0/umd/Recharts.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* Print styles to hide UI elements when saving report */
        @media print {
            .no-print { display: none !important; }
            body { background-color: white; }
            .print-container { box-shadow: none; border: none; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        // Destructure Recharts from the global object
        const { ResponsiveContainer, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, Cell } = window.Recharts;

        // --- Icons (Inline SVGs to prevent CDN errors) ---
        
        const Shield = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        );
        const Activity = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        );
        const Cpu = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></svg>
        );
        const CheckCircle = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        );
        const ArrowRight = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
        );
        const ArrowLeft = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
        );
        const FileText = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
        );
        const Stethoscope = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3"/><path d="M8 15v6a2 2 0 0 0 2 2v0a2 2 0 0 0 2-2v-6"/><circle cx="12" cy="4" r="2"/></svg>
        );
        const Download = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        );
        const ChevronRight = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="9 18 15 12 9 6"/></svg>
        );

        // --- Data Structure ---

        const CATEGORIES = {
            SECURITY: 'Security & Compliance',
            STRATEGY: 'Strategy & Future',
            EFFICIENCY: 'Workflow & Ops'
        };

        const QUESTIONS = [
            // Security Group
            {
                id: 1,
                category: CATEGORIES.SECURITY,
                question: "How does your IT provider demonstrate their own internal security and compliance standards?",
                options: [
                    { label: "A", text: "They never mentioned their own IT security and compliance.", score: 0 },
                    { label: "B", text: "They claim to follow best practices, but cannot provide documentation/certifications.", score: 5 },
                    { label: "C", text: "They provide evidence of regular external audits and hold certifications (ISO 27001, SOC 2).", score: 10 }
                ]
            },
            {
                id: 2,
                category: CATEGORIES.SECURITY,
                question: "What does your provider’s security and HIPAA compliance package look like?",
                options: [
                    { label: "A", text: "We mostly just have antivirus and a firewall. HIPAA is largely up to us.", score: 0 },
                    { label: "B", text: "Standard tools (MFA, basic AV), but risk assessments are rare or require extra fees.", score: 5 },
                    { label: "C", text: "Comprehensive: MFA, EDR/MDR, and regular HIPAA assessments included.", score: 10 }
                ]
            },
            // Efficiency Group
            {
                id: 3,
                category: CATEGORIES.EFFICIENCY,
                question: "How involved is your IT provider with your EHR/EMR and clinical workflows?",
                options: [
                    { label: "A", text: "They don't touch the EHR. We call the vendor for everything.", score: 0 },
                    { label: "B", text: "They help with basic connectivity but don't understand clinical workflows.", score: 5 },
                    { label: "C", text: "They have direct relationships with our vendor and optimize our workflows.", score: 10 }
                ]
            },
            // Strategy Group
            {
                id: 4,
                category: CATEGORIES.STRATEGY,
                question: "How many other medical practices does your IT provider support?",
                options: [
                    { label: "A", text: "We are one of their few medical clients; they do general small business IT.", score: 0 },
                    { label: "B", text: "They have a handful of medical clients, but it's a mix of industries.", score: 5 },
                    { label: "C", text: "They specialize in healthcare, bringing us 'best practices' learned from others.", score: 10 }
                ]
            },
            // Strategy Group
            {
                id: 5,
                category: CATEGORIES.STRATEGY,
                question: "How is your provider guiding you on AI adoption?",
                options: [
                    { label: "A", text: "They haven't mentioned it, or just said 'be careful'.", score: 0 },
                    { label: "B", text: "Generic advice or basic policy templates.", score: 5 },
                    { label: "C", text: "Actively educating us, piloting tools, and setting up safeguards.", score: 10 }
                ]
            },
            // Efficiency Group
            {
                id: 6,
                category: CATEGORIES.EFFICIENCY,
                question: "How would you describe your relationship regarding planning and strategy?",
                options: [
                    { label: "A", text: "Break/Fix. We call when something breaks; they send a bill.", score: 0 },
                    { label: "B", text: "Monthly fee, but we rarely discuss strategy or long-term roadmaps.", score: 5 },
                    { label: "C", text: "Proactive partnership with regular roadmap meetings.", score: 10 }
                ]
            },
            // Strategy Group
            {
                id: 7,
                category: CATEGORIES.STRATEGY,
                question: "Is your provider investing in specialized expertise for the future of healthcare?",
                options: [
                    { label: "A", text: "No, they offer the same services they did 5 years ago.", score: 0 },
                    { label: "B", text: "Keeping the lights on, but no new healthcare innovation teams.", score: 5 },
                    { label: "C", text: "Yes, dedicated experts (AI, Cyber) and next-gen vendor relationships.", score: 10 }
                ]
            },
            // Efficiency Group
            {
                id: 8,
                category: CATEGORIES.EFFICIENCY,
                question: "Is your provider active in the medical community?",
                options: [
                    { label: "A", text: "No, they are invisible outside of our office.", score: 0 },
                    { label: "B", text: "Occasional event attendance but not deeply involved.", score: 5 },
                    { label: "C", text: "Yes, supports societies, speaks at events, integrated in the community.", score: 10 }
                ]
            },
            // Security Group
            {
                id: 9,
                category: CATEGORIES.SECURITY,
                question: "The 'Closet' Test: What is the state of your physical IT infrastructure?",
                options: [
                    { label: "A", text: "A mess of tangled cables and dust. We try not to look at it.", score: 0 },
                    { label: "B", text: "It’s functional but cluttered.", score: 5 },
                    { label: "C", text: "Immaculate, organized, labeled, and secure.", score: 10 }
                ]
            },
            // Strategy Group
            {
                id: 10,
                category: CATEGORIES.STRATEGY,
                question: "How does the provider advise on infrastructure (Cloud vs. On-Premise)?",
                options: [
                    { label: "A", text: "They just patch old servers; haven't discussed a shift.", score: 0 },
                    { label: "B", text: "They mention cloud, but strategy for our data is unclear.", score: 5 },
                    { label: "C", text: "Clear strategy based on performance, cost, and security specifically for us.", score: 10 }
                ]
            },
            // Efficiency Group
            {
                id: 11,
                category: CATEGORIES.EFFICIENCY,
                question: "How well does your provider coordinate with third-party vendors (EHR, PACS, Labs)?",
                options: [
                    { label: "A", text: "We handle calls ourselves; IT avoids them.", score: 0 },
                    { label: "B", text: "Occasional help, but mostly tell us to call the vendor.", score: 5 },
                    { label: "C", text: "They own vendor relationships and resolve issues directly.", score: 10 }
                ]
            },
            // Security Group
            {
                id: 12,
                category: CATEGORIES.SECURITY,
                question: "How prepared is your practice for a disaster (ransomware, power loss)?",
                options: [
                    { label: "A", text: "Not sure; backups exist but aren't tested.", score: 0 },
                    { label: "B", text: "Backups exist, but no recovery practice in 12 months.", score: 5 },
                    { label: "C", text: "Documented plan, tested recoveries, clear recovery-time targets.", score: 10 }
                ]
            }
        ];

        // --- Components ---

        const IntroScreen = ({ onStart }) => (
            <div className="flex flex-col items-center justify-center p-8 text-center fade-in">
                <div className="bg-blue-100 p-4 rounded-full mb-6">
                    <Stethoscope className="w-12 h-12 text-blue-600" />
                </div>
                <h1 className="text-4xl font-bold text-gray-900 mb-4">Medical Practice IT Check</h1>
                <p className="text-lg text-gray-600 max-w-2xl mb-8 leading-relaxed">
                    Healthcare IT is not about fixing broken printers and responding to tickets - Take this short quiz to understand where your provider is and what gaps need to be addressed
                </p>
                
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10 w-full max-w-4xl">
                    <div className="bg-white p-4 rounded-lg shadow-sm border border-gray-100">
                        <Shield className="w-8 h-8 text-teal-500 mb-2 mx-auto" />
                        <h3 className="font-semibold text-gray-800">Security</h3>
                        <p className="text-sm text-gray-500">Assess your HIPAA & Cyber posture</p>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow-sm border border-gray-100">
                        <Activity className="w-8 h-8 text-indigo-500 mb-2 mx-auto" />
                        <h3 className="font-semibold text-gray-800">Efficiency</h3>
                        <p className="text-sm text-gray-500">Check clinical workflow optimization</p>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow-sm border border-gray-100">
                        <Cpu className="w-8 h-8 text-purple-500 mb-2 mx-auto" />
                        <h3 className="font-semibold text-gray-800">Innovation</h3>
                        <p className="text-sm text-gray-500">AI readiness & future planning</p>
                    </div>
                </div>

                <button 
                    onClick={onStart}
                    className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-full shadow-lg transition transform hover:scale-105 flex items-center gap-2 text-xl"
                >
                    Start Assessment <ArrowRight className="w-6 h-6" />
                </button>
            </div>
        );

        const QuizScreen = ({ question, currentStep, totalSteps, onAnswer, toastMessage, selectedLabel, onBack, onNext }) => {
            return (
                <div className="w-full max-w-3xl mx-auto fade-in">
                    {/* Progress */}
                    <div className="mb-8">
                        <div className="flex justify-between text-sm font-medium text-gray-500 mb-2">
                            <span>Question {currentStep} of {totalSteps}</span>
                            <span>{Math.round((currentStep / totalSteps) * 100)}% Complete</span>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-2.5">
                            <div 
                                className="bg-blue-600 h-2.5 rounded-full transition-all duration-500" 
                                style={{ width: `${(currentStep / totalSteps) * 100}%` }}
                            ></div>
                        </div>
                    </div>

                    {/* Toast Motivation */}
                    {toastMessage && (
                        <div className="mb-6 bg-green-50 text-green-700 px-4 py-3 rounded-lg border border-green-200 flex items-center animate-bounce">
                            <CheckCircle className="w-5 h-5 mr-2" />
                            {toastMessage}
                        </div>
                    )}

                    {/* Question Card */}
                    <div className="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden relative">
                        <div className="bg-gray-50 px-6 py-4 border-b border-gray-100">
                            <span className="text-xs font-bold tracking-wider text-blue-600 uppercase bg-blue-100 px-2 py-1 rounded">
                                {question.category}
                            </span>
                        </div>
                        
                        <div className="p-6 md:p-8 pb-20"> {/* pb-20 to make room for nav buttons */}
                            <h2 className="text-2xl font-bold text-gray-800 mb-8">{question.question}</h2>
                            
                            <div className="space-y-4">
                                {question.options.map((option, idx) => {
                                    const isSelected = selectedLabel === option.label;
                                    return (
                                        <button
                                            key={idx}
                                            onClick={() => onAnswer(option.score, option.label)}
                                            className={`w-full text-left p-4 rounded-lg border-2 transition-all duration-200 group flex items-start ${
                                                isSelected 
                                                    ? 'border-blue-500 bg-blue-50' 
                                                    : 'border-gray-200 hover:border-blue-500 hover:bg-blue-50'
                                            }`}
                                        >
                                            <div className={`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center mr-4 transition-colors ${
                                                isSelected 
                                                    ? 'bg-blue-600 text-white' 
                                                    : 'bg-gray-200 text-gray-600 group-hover:bg-blue-600 group-hover:text-white'
                                            }`}>
                                                {option.label}
                                            </div>
                                            <span className={`pt-1 ${isSelected ? 'text-gray-900 font-medium' : 'text-gray-700 group-hover:text-gray-900'}`}>
                                                {option.text}
                                            </span>
                                        </button>
                                    );
                                })}
                                {/* IDK Option */}
                                <button
                                    onClick={() => onAnswer(0, 'IDK')}
                                    className={`w-full text-center p-5 rounded-lg text-lg font-medium transition-colors border border-dashed mt-4 ${
                                        selectedLabel === 'IDK'
                                            ? 'bg-gray-100 border-gray-500 text-gray-900'
                                            : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50 border-gray-300 hover:border-gray-400'
                                    }`}
                                >
                                    I don't know
                                </button>
                            </div>
                        </div>

                        {/* Navigation Buttons */}
                        <div className="bg-gray-50 p-4 border-t border-gray-100 flex justify-between items-center">
                            <button
                                onClick={onBack}
                                disabled={currentStep === 1}
                                className={`flex items-center gap-2 px-4 py-2 rounded font-medium transition-colors ${
                                    currentStep === 1 
                                        ? 'text-gray-300 cursor-not-allowed' 
                                        : 'text-gray-600 hover:text-blue-600 hover:bg-blue-50'
                                }`}
                            >
                                <ArrowLeft className="w-5 h-5" /> Back
                            </button>
                            
                            {selectedLabel && (
                                <button
                                    onClick={onNext}
                                    className="flex items-center gap-2 px-4 py-2 rounded font-medium text-blue-600 hover:bg-blue-50 transition-colors"
                                >
                                    Next <ArrowRight className="w-5 h-5" />
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const ResultsScreen = ({ score, categoryBreakdown, maxScore }) => {
            let zone, diagnosis, action, cta, colorClass;

            if (score <= 50) {
                zone = "The 'At Risk' Zone";
                diagnosis = "Your provider is acting as a utility mechanic, not a partner. You are likely overexposed to security risks and missing out on efficiency gains.";
                action = "Take these results to your provider and ask how they can provide this core expertise. It may cost more, but you need to make sure your practice is set up for success.";
                cta = "Book a Free Risk Audit";
                colorClass = "text-red-600";
            } else if (score <= 85) {
                zone = "The 'Stable but Stagnant' Zone";
                diagnosis = "Your IT is functional, but likely generic. They keep you safe, but they aren't helping you grow or navigate the changing healthcare landscape.";
                action = "Challenge your current provider to be more strategic. Consider a second opinion to improve the attention you are getting or provide you with a better partner.";
                cta = "Download Strategic Checklist";
                colorClass = "text-yellow-600";
            } else {
                zone = "High-Maturity IT Partner";
                diagnosis = "You have a high-maturity IT partner who understands the business of medicine. You are well-positioned for the future.";
                action = "Focus on deepening this relationship and leveraging their advanced capabilities (AI, data analytics).";
                cta = "Share Your Success Story";
                colorClass = "text-green-600";
            }

            const chartData = [
                { name: 'Security', score: categoryBreakdown[CATEGORIES.SECURITY], full: 40 },
                { name: 'Strategy', score: categoryBreakdown[CATEGORIES.STRATEGY], full: 40 },
                { name: 'Efficiency', score: categoryBreakdown[CATEGORIES.EFFICIENCY], full: 40 },
            ];

            const handlePrint = () => {
                window.print();
            };

            return (
                <div className="w-full max-w-4xl mx-auto fade-in print-container bg-white p-8 rounded-xl shadow-xl">
                    <div className="text-center mb-10 border-b border-gray-200 pb-8">
                        <h2 className="text-gray-500 uppercase tracking-widest text-sm font-semibold mb-2">Assessment Complete</h2>
                        <h1 className={`text-4xl md:text-5xl font-extrabold mb-4 ${colorClass}`}>{zone}</h1>
                        <p className="text-xl text-gray-600 mb-6">Your Score: <span className="font-bold text-gray-900">{score}</span> / {maxScore}</p>
                        <div className="w-full bg-gray-200 rounded-full h-4 mb-4">
                            <div 
                                className={`h-4 rounded-full ${score > 85 ? 'bg-green-500' : score > 50 ? 'bg-yellow-500' : 'bg-red-500'}`} 
                                style={{ width: `${(score / maxScore) * 100}%` }}
                            ></div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-10 mb-10">
                        <div>
                            <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <FileText className="w-5 h-5 text-blue-600" /> Diagnosis
                            </h3>
                            <p className="text-gray-700 leading-relaxed mb-6 bg-gray-50 p-4 rounded-lg border-l-4 border-blue-500">
                                {diagnosis}
                            </p>
                            
                            <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <ChevronRight className="w-5 h-5 text-blue-600" /> Recommended Action
                            </h3>
                            <p className="text-gray-700 leading-relaxed bg-gray-50 p-4 rounded-lg border-l-4 border-indigo-500">
                                {action}
                            </p>
                        </div>

                        <div className="h-64 md:h-auto flex flex-col items-center justify-center bg-slate-50 rounded-xl p-4">
                            <h3 className="text-sm font-bold text-gray-500 mb-4 uppercase">Category Breakdown</h3>
                            <ResponsiveContainer width="100%" height={250}>
                                <BarChart data={chartData} layout="vertical" margin={{ top: 5, right: 30, left: 40, bottom: 5 }}>
                                    <CartesianGrid strokeDasharray="3 3" horizontal={false} />
                                    <XAxis type="number" domain={[0, 40]} hide />
                                    <YAxis dataKey="name" type="category" width={80} tick={{fontSize: 12}} />
                                    <Tooltip cursor={{fill: 'transparent'}} />
                                    <Bar dataKey="score" fill="#3b82f6" radius={[0, 4, 4, 0]} barSize={30}>
                                        {chartData.map((entry, index) => (
                                            <Cell key={`cell-${index}`} fill={entry.score < 20 ? '#ef4444' : entry.score < 30 ? '#eab308' : '#22c55e'} />
                                        ))}
                                    </Bar>
                                </BarChart>
                            </ResponsiveContainer>
                        </div>
                    </div>

                    <div className="flex justify-center no-print">
                        <button onClick={() => window.location.reload()} className="px-10 py-4 rounded-lg bg-blue-600 text-white hover:bg-blue-700 font-bold text-lg shadow-lg transition transform hover:-translate-y-1">
                            Retake Assessment
                        </button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('intro'); // intro, quiz, results
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [answers, setAnswers] = useState([]); // Array of { score, category, label }
            const [toast, setToast] = useState(null);

            const handleStart = () => setView('quiz');

            const handleAnswer = (score, label) => {
                const currentQuestion = QUESTIONS[currentQuestionIndex];
                
                // Update specific index in answers array to allow re-answering
                const newAnswers = [...answers];
                newAnswers[currentQuestionIndex] = { 
                    score, 
                    category: currentQuestion.category, 
                    label 
                };
                setAnswers(newAnswers);

                // Motivation Logic
                if ((currentQuestionIndex + 1) % 4 === 0 && currentQuestionIndex !== QUESTIONS.length - 1) {
                    const msg = currentQuestionIndex === 3 ? "Great start! You're uncovering key insights." 
                              : "Halfway there! Keep going."
                    setToast(msg);
                    setTimeout(() => setToast(null), 3000);
                }

                // Advance
                if (currentQuestionIndex < QUESTIONS.length - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                } else {
                    setView('results');
                }
            };
            
            const handleBack = () => {
                if (currentQuestionIndex > 0) {
                    setCurrentQuestionIndex(prev => prev - 1);
                }
            };
            
            const handleNext = () => {
                 if (currentQuestionIndex < QUESTIONS.length - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                } else if (answers[currentQuestionIndex]) { // Only allow finish if answered
                    setView('results');
                }
            };

            const calculateResults = useMemo(() => {
                const totalScore = answers.reduce((acc, curr) => acc + (curr ? curr.score : 0), 0);
                
                const breakdown = {
                    [CATEGORIES.SECURITY]: 0,
                    [CATEGORIES.STRATEGY]: 0,
                    [CATEGORIES.EFFICIENCY]: 0
                };

                answers.forEach(a => {
                    if (a) {
                        breakdown[a.category] += a.score;
                    }
                });

                return { totalScore, breakdown };
            }, [answers]);

            return (
                <div className="min-h-screen py-10 px-4 md:px-8 bg-slate-50 flex items-center justify-center">
                    {view === 'intro' && <IntroScreen onStart={handleStart} />}
                    
                    {view === 'quiz' && (
                        <QuizScreen 
                            question={QUESTIONS[currentQuestionIndex]} 
                            currentStep={currentQuestionIndex + 1}
                            totalSteps={QUESTIONS.length}
                            onAnswer={handleAnswer}
                            onBack={handleBack}
                            onNext={handleNext}
                            toastMessage={toast}
                            selectedLabel={answers[currentQuestionIndex]?.label}
                        />
                    )}

                    {view === 'results' && (
                        <ResultsScreen 
                            score={calculateResults.totalScore}
                            categoryBreakdown={calculateResults.breakdown}
                            maxScore={QUESTIONS.length * 10}
                        />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
